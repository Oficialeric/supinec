<html><head><base href="https://example.com/ti-helpdesk/?">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de Chamados de TI - Dashboard Escolar</title>
<style>
    body {
        font-family: 'Roboto', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f0f2f5;
        padding-bottom: 60px; /* Add space for the footer */
    }
    body.dark-theme {
        background-color: #1a1a1a;
        color: #f0f0f0;
    }
    #dateTime {
        position: fixed;
        bottom: 10px;
        right: 10px;
        background-color: #000000;
        color: #ffffff;
        padding: 8px 12px;
        border-radius: 5px;
        font-size: 14px;
        z-index: 1000;
    }
    body.dark-theme #dateTime {
        background-color: #000000;
        color: #ffffff;
    }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.9);
        margin-bottom: 60px; /* Ensure content doesn't overlap with footer */
    }
    body.dark-theme .container {
        background-color: rgba(30, 30, 30, 0.9);
    }
    header {
        background-color: #2c3e50;
        color: white;
        padding: 20px;
        text-align: center;
        position: relative;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    body.dark-theme header {
        background-color: #2c3e50;
    }
    h1 {
        margin: 0;
    }
    .dashboard {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
        margin-bottom: 20px;
    }
    .full-width {
        grid-column: 1 / -1;
        margin-top: 20px;
    }
    .card {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
        transition: transform 0.3s ease;
    }
    body.dark-theme .card {
        background-color: #2c2c2c;
        color: #f0f0f0;
    }
    body.dark-theme .card h2 {
        color: #f0f0f0;
    }
    .card:hover {
        transform: translateY(-5px);
    }
    .chart-container {
        height: 400px;
        max-width: 1000px;
        margin: 0 auto;
    }
    #newTicketBtn {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }
    #newTicketBtn:hover {
        background-color: #2980b9;
    }
    #whatsappBtn {
        background-color: #25D366;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-left: 10px;
    }
    #whatsappBtn:hover {
        background-color: #128C7E;
    }
    #whatsappBtn2 {
        background-color: #25D366;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        margin-left: 10px;
    }
    #whatsappBtn2:hover {
        background-color: #128C7E;
    }
    #ticketModal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
    }
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        border-radius: 8px;
    }
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    .close:hover {
        color: #000;
    }
    form {
        display: flex;
        flex-direction: column;
    }
    form input, form textarea, form select {
        margin-bottom: 10px;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    form button {
        width: 100%;
        padding: 10px;
        background-color: #3498db;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        font-size: 16px;
        margin-top: 10px;
    }
    form button:hover {
        background-color: #2980b9;
    }
    #recentTickets, #finishedTickets {
        list-style-type: none;
        padding: 0;
    }
    #recentTickets li, #finishedTickets li {
        margin-bottom: 10px;
        padding: 10px;
        background-color: #f9f9f9;
        border-radius: 4px;
        font-size: 14px;
    }
    body.dark-theme #recentTickets li, 
    body.dark-theme #finishedTickets li {
        background-color: #3a3a3a;
    }
    body.dark-theme #recentTickets li.new-ticket {
        background-color: #1a3a1a;
    }
    body.dark-theme #finishedTickets li.finished-ticket {
        background-color: #3a1a1a;
    }
    #recentTickets li.new-ticket {
        background-color: #e6ffe6;
        border-left: 4px solid #2ecc71;
    }
    #finishedTickets li.finished-ticket {
        background-color: #ffe6e6;
        border-left: 4px solid #e74c3c;
    }
    .ticket-time {
        font-size: 12px;
        color: #666;
        display: block;
        margin-top: 5px;
    }
    body.dark-theme .ticket-time {
        color: #bbb;
    }
    .ticket-actions {
        margin-top: 5px;
    }
    .ticket-actions button {
        margin-right: 5px;
        padding: 5px 10px;
        font-size: 12px;
        cursor: pointer;
    }
    .timer {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
    }
    #themeToggle {
        position: fixed;
        bottom: 10px;
        left: 10px;
        z-index: 1000;
        background-color: #4a4a4a;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: pointer;
    }
    #userManagement {
        background-color: #f0f2f5;
        transition: background-color 0.3s ease;
    }
    body.dark-theme #userManagement {
        background-color: #1a1a1a;
        color: #f0f0f0;
    }
    #userManagement h2, #userManagement h3 {
        color: #333;
        transition: color 0.3s ease;
    }
    body.dark-theme #userManagement h2, body.dark-theme #userManagement h3 {
        color: #f0f0f0;
    }
    #userManagement button, #userManagement input[type="text"], #userManagement input[type="password"] {
        background-color: #fff;
        color: #333;
        border: 1px solid #ddd;
        transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }
    body.dark-theme #userManagement button, 
    body.dark-theme #userManagement input[type="text"], 
    body.dark-theme #userManagement input[type="password"] {
        background-color: #2c2c2c;
        color: #f0f0f0;
        border-color: #444;
    }
    #userList li {
        background-color: #fff;
        color: #333;
        border: 1px solid #ddd;
        padding: 10px;
        margin-bottom: 10px;
        transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }
    body.dark-theme #userList li {
        background-color: #2c2c2c;
        color: #f0f0f0;
        border-color: #444;
    }
    #initialMenu {
        text-align: center; 
        padding: 20px; 
        max-width: 400px; 
        margin: 0 auto;
    }
    #initialMenu img {
        max-width: 200px; 
        max-height: 100px; 
        margin-bottom: 20px; 
        cursor: pointer;
    }
    #loginForm input {
        margin-bottom: 10px; 
        width: 100%; 
        padding: 8px; 
        box-sizing: border-box;
    }
    #initialMenu button {
        width: 100%; 
        padding: 10px; 
        margin-bottom: 10px; 
        background-color: #2ecc71; 
        color: white; 
        border: none; 
        cursor: pointer;
    }
    #footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: #f0f2f5;
        padding: 10px;
        text-align: center;
        box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
    }
    body.dark-theme #footer {
        background-color: #2c2c2c;
    }
    #footer button {
        margin: 0 10px;
    }
    #dashboardNewTicketBtn {
        background-color: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        position: static; 
    }
    #dashboardNewTicketBtn:hover {
        background-color: #2980b9;
    }
    #exportExcelBtn {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        position: static; 
    }
    #exportExcelBtn:hover {
        background-color: #45a049;
    }
    /* Update styles for logoutBtn and userManagementBtn */
    #logoutBtn, #userManagementBtn {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        position: static;
    }
    #logoutBtn:hover, #userManagementBtn:hover {
        background-color: #45a049;
    }
</style>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&amp;display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="initialMenu">
        <img src="https://example.com/ti-helpdesk/logo.png" alt="Logo" onerror="this.onerror=null; this.src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=';">
        <input type="file" id="logoUpload" accept="image/*" style="display: none;">
        <form id="loginForm" style="margin-bottom: 20px;">
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
        <div>
            <button id="newTicketBtn">Abrir Novo Chamado</button>
        </div>
    </div>
    <div id="userManagement" style="display: none; padding: 20px; background-color: #f0f2f5;">
        <h2>Gerenciamento de Usuários</h2>
        <button id="backToMainBtn">Voltar</button>
        <form id="createUserForm" style="margin-top: 20px;">
            <input type="text" id="newUsername" placeholder="Novo Nome de Usuário" required="">
            <input type="password" id="newPassword" placeholder="Nova Senha" required="">
            <label>
                <input type="checkbox" id="isAdmin"> É Administrador
            </label>
            <button type="submit">Criar Usuário</button>
        </form>
        <h3>Usuários Existentes</h3>
        <ul id="userList" style="list-style-type: none; padding: 0;"></ul>
    </div>
    <div id="changePassword" style="display: none;">
        <h2>Change Password</h2>
        <form id="changePasswordForm">
            <input type="password" id="currentPassword" placeholder="Current Password" required="">
            <input type="password" id="newPassword" placeholder="New Password" required="">
            <input type="password" id="confirmPassword" placeholder="Confirm New Password" required="">
            <button type="submit">Change Password</button>
        </form>
    </div>
    <button id="themeToggle">Alternar Tema</button>
    <div id="dateTime"></div>
    <div class="container" style="display: none;">
        <header>
            <button id="dashboardNewTicketBtn">Abrir Novo Chamado</button>
            <button id="exportExcelBtn">Exportar para Excel</button>
            <button id="userManagementBtn">Gerenciar Usuários</button>
            <button id="logoutBtn">Sair</button>
        </header>
        <div class="dashboard">
            <div class="card">
                <h2>Chamados Recentes</h2>
                <ul id="recentTickets"></ul>
            </div>
            <div class="card">
                <h2>Chamados Finalizados</h2>
                <ul id="finishedTickets"></ul>
            </div>
        </div>
        <div class="card full-width">
            <h2>Chamados por Setor</h2>
            <div class="chart-container">
                <canvas id="departmentChart"></canvas>
            </div>
        </div>
    </div>

    <div id="ticketModal">
        <div class="modal-content">
            <span class="close">×</span>
            <h2>Abrir Novo Chamado</h2>
            <form id="newTicketForm">
                <input type="text" id="name" placeholder="Nome" required="">
                <select id="department" required="">
                    <option value="">Selecione o Setor</option>
                    <option value="Anos Finais">Anos Finais</option>
                    <option value="Anos Iniciais">Anos Iniciais</option>
                    <option value="Berçário">Berçário</option>
                    <option value="Ensino Médio">Ensino Médio</option>
                    <option value="Financeiro">Financeiro</option>
                    <option value="Infantil">Infantil</option>
                    <option value="Marketing">Marketing</option>
                    <option value="RH">RH</option>
                    <option value="TI">TI</option>
                </select>
                <input type="text" id="subject" placeholder="Assunto" required="">
                <textarea id="description" placeholder="Descrição" required=""></textarea>
                <textarea id="comments" placeholder="Comentários"></textarea>
                <button type="submit">Enviar Chamado</button>
            </form>
        </div>
    </div>

    <div id="footer">
        <button id="whatsappBtn">Falar com Agatha</button>
        <button id="whatsappBtn2">Falar com Eric</button>
    </div>

    <script>
    let users = [
        { username: 'admin', password: 'admin123', isAdmin: true },
        { username: 'user', password: 'user123', isAdmin: false },
        { username: '417161', password: '417161@', isAdmin: true }  // Changed isAdmin to true
    ];

    let currentUser = null;

    document.addEventListener('DOMContentLoaded', function() {
        const initialMenu = document.getElementById('initialMenu');
        const container = document.querySelector('.container');
        const loginForm = document.getElementById('loginForm');

        container.style.display = 'none';

        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const user = authenticateUser(username, password);
            if (user) {
                currentUser = user;
                initialMenu.style.display = 'none';
                showMainContent();
            } else {
                alert('Credenciais inválidas');
            }
        });

        document.getElementById('newTicketBtn').addEventListener('click', function() {
            document.getElementById('ticketModal').style.display = 'block';
        });

        document.getElementById('dashboardNewTicketBtn').addEventListener('click', function() {
            document.getElementById('ticketModal').style.display = 'block';
        });

        document.getElementById('exportExcelBtn').addEventListener('click', exportToExcel);

        document.getElementById('newTicketForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('name').value;
            const department = document.getElementById('department').value;
            const subject = document.getElementById('subject').value;
            const description = document.getElementById('description').value;
            const comments = document.getElementById('comments').value;
            const now = new Date();
            const timeString = now.toLocaleString('pt-BR', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });

            const newTicket = {
                name: name,
                department: department,
                subject: subject,
                description: description,
                comments: comments,
                time: timeString,
                startTime: null,
                endTime: null
            };

            recentTickets.unshift(newTicket);
            updateRecentTickets(recentTickets);
            updateDepartmentChart();
            saveTicketsToLocalStorage();

            document.getElementById('ticketModal').style.display = "none";
            this.reset();

            showNotification('Seu chamado foi aberto com sucesso e encaminhado para a equipe de TI. Aguarde para ser atendido.');
        });
    });

    function exportToExcel() {
        const allTickets = [...recentTickets, ...finishedTickets];
        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent += "Nome,Departamento,Assunto,Descrição,Comentários,Data de Abertura,Início,Finalização\n";
        
        allTickets.forEach(ticket => {
            const row = [
                ticket.name,
                ticket.department,
                ticket.subject,
                ticket.description,
                ticket.comments,
                ticket.time,
                ticket.startTime ? new Date(ticket.startTime).toLocaleString() : '',
                ticket.endTime ? new Date(ticket.endTime).toLocaleString() : ''
            ].map(cell => `"${cell}"`).join(',');
            csvContent += row + "\n";
        });
        
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "chamados_ti.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function showNotification(message) {
        const notification = document.createElement('div');
        notification.textContent = message;
        notification.style.position = 'fixed';
        notification.style.top = '20px';
        notification.style.left = '50%';
        notification.style.transform = 'translateX(-50%)';
        notification.style.backgroundColor = '#4CAF50';
        notification.style.color = 'white';
        notification.style.padding = '15px';
        notification.style.borderRadius = '5px';
        notification.style.zIndex = '1000';
        document.body.appendChild(notification);

        setTimeout(() => {
            notification.remove();
        }, 5000);
    }

    function authenticateUser(username, password) {
        return users.find(user => user.username === username && user.password === password) || null;
    }

    function showMainContent() {
        document.querySelector('.container').style.display = 'block';
        document.getElementById('userManagementBtn').style.display = currentUser && currentUser.isAdmin ? 'block' : 'none';
        loadTicketsFromLocalStorage();
        updateRecentTickets(recentTickets);
        updateFinishedTickets(finishedTickets);
        updateDepartmentChart();
        applyCurrentTheme(); // Add this line
    }

    document.getElementById('userManagementBtn').addEventListener('click', function() {
        document.querySelector('.container').style.display = 'none';
        document.getElementById('userManagement').style.display = 'block';
        updateUserList();
        applyCurrentTheme(); // Add this line
    });

    document.getElementById('backToMainBtn').addEventListener('click', function() {
        document.getElementById('userManagement').style.display = 'none';
        showMainContent();
    });

    document.getElementById('createUserForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const newUsername = document.getElementById('newUsername').value;
        const newPassword = document.getElementById('newPassword').value;
        const isAdmin = document.getElementById('isAdmin').checked;
        users.push({ username: newUsername, password: newPassword, isAdmin: isAdmin });
        updateUserList();
        this.reset();
    });

    function updateUserList() {
        const userList = document.getElementById('userList');
        userList.innerHTML = '';
        users.forEach((user, index) => {
            if (user.username !== currentUser.username) {
                const li = document.createElement('li');
                li.style.marginBottom = '10px';
                li.innerHTML = `
                    ${user.username} (${user.isAdmin ? 'Admin' : 'Usuário'})
                    <button onclick="deleteUser(${index})">Excluir</button>
                    <button onclick="toggleAdminStatus(${index})">${user.isAdmin ? 'Remover Admin' : 'Tornar Admin'}</button>
                `;
                userList.appendChild(li);
            }
        });
    }

    function toggleAdminStatus(index) {
        users[index].isAdmin = !users[index].isAdmin;
        updateUserList();
    }

    function deleteUser(index) {
        if (confirm('Tem certeza que deseja excluir este usuário?')) {
            users.splice(index, 1);
            updateUserList();
        }
    }

    document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (currentPassword !== currentUser.password) {
            alert('Current password is incorrect');
            return;
        }

        if (newPassword !== confirmPassword) {
            alert('New passwords do not match');
            return;
        }

        currentUser.password = newPassword;
        const userIndex = users.findIndex(user => user.username === currentUser.username);
        users[userIndex] = currentUser;

        alert('Password changed successfully');
        this.reset();
    });

    const modal = document.getElementById('ticketModal');
    const btn = document.getElementById('newTicketBtn');
    const span = document.getElementsByClassName('close')[0];

    btn.onclick = function() {
        modal.style.display = "block";
    }

    span.onclick = function() {
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    function updateDepartmentChart() {
        const departmentCounts = {};
        recentTickets.concat(finishedTickets).forEach(ticket => {
            departmentCounts[ticket.department] = (departmentCounts[ticket.department] || 0) + 1;
        });

        const chartData = {
            labels: ['Anos Finais', 'Anos Iniciais', 'Berçário', 'Ensino Médio', 'Financeiro', 'Infantil', 'Marketing', 'RH', 'TI'],
            datasets: [{
                label: 'Número de Chamados',
                data: [],
                backgroundColor: ['#4BC0C0', '#FFCE56', '#FF6384', '#9966FF', '#C9CBCF', '#36A2EB', '#7CFC00', '#FF9F40', '#FF6384']
            }]
        };

        chartData.datasets[0].data = chartData.labels.map(dept => departmentCounts[dept] || 0);

        const ctx = document.getElementById('departmentChart').getContext('2d');

        if (window.departmentChart instanceof Chart) {
            window.departmentChart.data = chartData;
            window.departmentChart.update();
        } else {
            window.departmentChart = new Chart(ctx, {
                type: 'bar',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Número de Chamados',
                                font: { size: 14 }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Setores',
                                font: { size: 14 }
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Chamados por Setor',
                            font: { size: 18 }
                        }
                    }
                }
            });
        }
    }

    function toggleTheme() {
        document.body.classList.toggle('dark-theme');
        applyCurrentTheme(); // Add this line
        const isDarkTheme = document.body.classList.contains('dark-theme');
        localStorage.setItem('darkTheme', isDarkTheme);
    }

    function setInitialTheme() {
        const isDarkTheme = localStorage.getItem('darkTheme') === 'true';
        if (isDarkTheme) {
            document.body.classList.add('dark-theme');
        }
        applyCurrentTheme();
    }

    function applyCurrentTheme() {
        const isDarkTheme = document.body.classList.contains('dark-theme');
        if (isDarkTheme) {
            document.getElementById('userManagement').classList.add('dark-theme');
        } else {
            document.getElementById('userManagement').classList.remove('dark-theme');
        }
    }

    document.getElementById('themeToggle').addEventListener('click', toggleTheme);

    document.getElementById('logoutBtn').addEventListener('click', function() {
        logout();
    });

    function logout() {
        currentUser = null;
        document.querySelector('.container').style.display = 'none';
        document.getElementById('userManagement').style.display = 'none';
        document.getElementById('initialMenu').style.display = 'block';
        document.getElementById('username').value = '';
        document.getElementById('password').value = '';
    }

    function updateDateTime() {
        const now = new Date();
        const dateTimeString = now.toLocaleString('pt-BR', { 
            year: 'numeric', 
            month: '2-digit', 
            day: '2-digit', 
            hour: '2-digit', 
            minute: '2-digit', 
            second: '2-digit'
        });
        document.getElementById('dateTime').textContent = dateTimeString;
    }

    window.onload = function() {
        setInitialTheme();
        loadTicketsFromLocalStorage();
        updateRecentTickets(recentTickets);
        updateFinishedTickets(finishedTickets);
        updateDepartmentChart();
        updateDateTime();
        setInterval(updateDateTime, 1000);
    };

    function updateRecentTickets(tickets) {
        const recentTicketsList = document.getElementById('recentTickets');
        recentTicketsList.innerHTML = '';
        tickets.forEach((ticket, index) => {
            const li = document.createElement('li');
            li.className = 'new-ticket';
            li.innerHTML = `
                <strong>${ticket.subject}</strong> - ${ticket.name} (${ticket.department})
                <span class="ticket-time">${ticket.time}</span>
                <p><strong>Descrição:</strong> ${ticket.description}</p>
                <p><strong>Comentários:</strong> ${ticket.comments || 'Nenhum comentário'}</p>
                <div class="ticket-actions">
                    <button onclick="startTicket(${index})">Iniciar</button>
                    <button onclick="finishTicket(${index})">Finalizar</button>
                </div>
                <div class="timer" data-index="${index}"></div>
            `;
            recentTicketsList.appendChild(li);
        });
        updateTimers();
    }

    function updateFinishedTickets(tickets) {
        const finishedTicketsList = document.getElementById('finishedTickets');
        finishedTicketsList.innerHTML = '';
        tickets.forEach(ticket => {
            const li = document.createElement('li');
            li.className = 'finished-ticket';
            li.innerHTML = `
                <strong>${ticket.subject}</strong> - ${ticket.name} (${ticket.department})
                <span class="ticket-time">Finalizado em: ${ticket.endTime}</span>
                <p><strong>Descrição:</strong> ${ticket.description}</p>
                <p><strong>Comentários:</strong> ${ticket.comments || 'Nenhum comentário'}</p>
            `;
            finishedTicketsList.appendChild(li);
        });
    }

    function startTicket(index) {
        if (!recentTickets[index].startTime) {
            recentTickets[index].startTime = new Date();
            updateRecentTickets(recentTickets);
            saveTicketsToLocalStorage();
        }
    }

    function finishTicket(index) {
        const ticket = recentTickets[index];
        ticket.endTime = new Date();
        finishedTickets.unshift(ticket);
        recentTickets.splice(index, 1);
        updateRecentTickets(recentTickets);
        updateFinishedTickets(finishedTickets);
        updateDepartmentChart();
        saveTicketsToLocalStorage();
    }

    function updateTimers() {
        const timers = document.querySelectorAll('.timer');
        timers.forEach(timer => {
            const index = timer.dataset.index;
            const ticket = recentTickets[index];
            if (ticket && ticket.startTime) {
                const elapsed = new Date() - new Date(ticket.startTime);
                const hours = Math.floor(elapsed / 3600000);
                const minutes = Math.floor((elapsed % 3600000) / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                timer.textContent = `Tempo decorrido: ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        });
    }

    setInterval(updateTimers, 1000);

    function saveTicketsToLocalStorage() {
        localStorage.setItem('recentTickets', JSON.stringify(recentTickets));
        localStorage.setItem('finishedTickets', JSON.stringify(finishedTickets));
    }

    function loadTicketsFromLocalStorage() {
        const savedRecentTickets = localStorage.getItem('recentTickets');
        const savedFinishedTickets = localStorage.getItem('finishedTickets');
        
        if (savedRecentTickets) {
            recentTickets = JSON.parse(savedRecentTickets);
        }
        
        if (savedFinishedTickets) {
            finishedTickets = JSON.parse(savedFinishedTickets);
        }
    }

    document.getElementById('whatsappBtn').addEventListener('click', function() {
        const phoneNumber = '5512988693097'; 
        const whatsappUrl = `https://wa.me/${phoneNumber}`;
        window.open(whatsappUrl, '_blank');
    });

    document.getElementById('whatsappBtn2').addEventListener('click', function() {
        const phoneNumber = '5512988351548'; 
        const whatsappUrl = `https://wa.me/${phoneNumber}`;
        window.open(whatsappUrl, '_blank');
    });

    function initializeLogoFunctionality() {
        const logoImg = document.querySelector('#initialMenu img');
        const logoUpload = document.getElementById('logoUpload');

        const savedLogo = localStorage.getItem('customLogo');
        if (savedLogo) {
            logoImg.src = savedLogo;
        }

        logoImg.addEventListener('click', () => {
            logoUpload.click();
        });

        logoUpload.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    logoImg.src = e.target.result;
                    localStorage.setItem('customLogo', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        });
    }

    document.addEventListener('DOMContentLoaded', initializeLogoFunctionality);
    </script>
</body>
</html>